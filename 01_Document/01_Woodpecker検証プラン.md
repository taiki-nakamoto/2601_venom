# Woodpecker検証プラン

## プロジェクトの目的

バックエンドの内部結合テストを主眼に置いた検証を行う。
単にWoodpeckerが動くだけでなく、AWS内の他リソース（API Gateway, Aurora）との接続性や、データの制御がポイントとなる。

## 1. 検証ステップ（進め方）

一度に全て構築するとトラブルシューティングが難しいため、以下の3フェーズで進める。

### フェーズ1：Woodpeckerの基礎構築（まずは動かす）

**やること:**
- EC2にWoodpeckerを立て、GitHubと連携

**確認点:**
- Web画面が見れるか
- `.woodpecker.yml` で単純な `echo "hello"` が動くか

### フェーズ2：API連携テスト（Venomの導入）

**やること:**
- API Gateway (Mock) を作成
- Woodpeckerから Venom を実行し、APIを叩いてレスポンスを確認

**確認点:**
- 外部へのHTTPリクエストがCI上から正常に通るか
- Venomのテストがパスするか

### フェーズ3：DB連携とデータ制御（本番想定）

**やること:**
- Aurora PostgreSQLを構築
- CIからDBへ接続し、テーブル作成やデータ投入（Seed）を実行

**確認点:**
- CIのコンテナからプライベートなDBに接続できるか
- DB更新後のAPIリクエストが期待通り変化するか

## 2. 検証全容と技術構成案

### 検証項目とチェックポイント

| カテゴリ | 検証したいこと（具体案） | 構築のポイント |
|---------|------------------------|--------------|
| CI基盤 | WoodpeckerのUI/UX、ビルドの速さ、ログの見やすさ。ECS(EC2)上でAgentがDockerを叩けるか。 | ECS(EC2)上でAgentがDockerを叩けるか。 |
| APIテスト | Venom をコンテナで実行し、API GatewayのMockから正しいJSONが返るか。 | Venomの定義ファイル（yaml）の管理方法。 |
| DB連携 | CIのステップ内でVenomのdbfixturesを用いてAuroraへ接続・データ操作。 | Security Group（EC2→Aurora）の許可設定。 |
| データ制御 | APIのリクエスト前にDBをクリア→特定データを投入するフローの実現。 | Venomの一つのYAMLファイル内でDB操作とHTTPリクエストを順番に実行。 |

## 3. 今回の検証における「構築の壁」

「数時間で削除する」という前提で、以下の2点が少し手間取る可能性がある。

### 接続性の確保
- CI（EC2）から Aurora（Private）に接続する必要がある
- 同じVPCに配置し、Security Groupでポート5432を開ける設定が必要

### Venom の実行
- Woodpeckerは各ステップがDockerコンテナ
- Venomを実行するための公式イメージ（ovhcom/venom）を使う
- 設定ファイルをどうマウントするかが鍵

## 4. 最初の第一歩としての提案

まずは、**フェーズ1と2を同時にクリアする構成**から始めるのがスムーズ。

詳細は「04_venom構築.md」を参照してください。
